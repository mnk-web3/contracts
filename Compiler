# syntax=docker/dockerfile:1.2

FROM node:18

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

RUN yarn global add truffle
RUN yarn add @harmony-js/core
RUN yarn add @truffle/hdwallet-provider

# bake in the compiler into the image
RUN truffle obtain --solc 0.8.15

COPY contracts contracts
COPY migrations migrations
COPY truffle-config.js .

CMD truffle migrate --network localnet --reset --skip-dry-run
